<!DOCTYPE html>
<html>
<head>
    <title>Kuvat videoksi</title>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <style>
        body { font-family: Arial; text-align: center; margin: 20px; }
        button { padding: 10px 20px; font-size: 16px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Lataa kuvat ja luo video</h1>
    <input type="file" id="imageUpload" accept="image/*" multiple>
    <button onclick="createVideo()">Luo video</button>
    <button onclick="downloadVideo()">Lataa video</button>
    <video id="outputVideo" controls></video>
    <script>
        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({ log: true });

        async function createVideo() {
            const images = document.getElementById('imageUpload').files;
            if (!images.length) {
                alert("Lataa kuvia ensin!");
                return;
            }

            document.body.style.cursor = "wait";
            alert("Luodaan videota, odota hetki...");

            if (!ffmpeg.isLoaded()) {
                await ffmpeg.load();
            }

            try {
                // Kirjoita kuvatiedostot
                for (let i = 0; i < images.length; i++) {
                    ffmpeg.FS('writeFile', `image${i}.jpg`, await fetchFile(images[i]));
                }

                // Aja FFmpeg-komento
                await ffmpeg.run(
                    '-framerate', '1',
                    '-i', 'image%d.jpg',
                    '-c:v', 'libx264',
                    '-r', '30',
                    '-pix_fmt', 'yuv420p',
                    'output.mp4'
                );

                // Lue tulostiedosto ja näytä video
                const data = ffmpeg.FS('readFile', 'output.mp4');
                const video = document.getElementById('outputVideo');
                video.src = URL.createObjectURL(
                    new Blob([data.buffer], { type: 'video/mp4' })
                );

                document.body.style.cursor = "default";
                alert("Video luotu onnistuneesti!");
            } catch (error) {
                document.body.style.cursor = "default";
                alert("Virhe videon luomisessa: " + error.message);
            }
        }

        function downloadVideo() {
            const video = document.getElementById('outputVideo');
            if (!video.src) {
                alert("Ei videota ladattavaksi!");
                return;
            }
            const a = document.createElement('a');
            a.href = video.src;
            a.download = 'luotu_video.mp4';
            a.click();
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <title>Kuvat videoksi</title>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.7/dist/umd/ffmpeg.umd.js"></script>
    <script src="https://unpkg.com/@ffmpeg/util@0.12.1/dist/umd/index.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background: #f0f0f0; }
        #outputVideo { width: 90%; margin-top: 20px; background: black; }
        button { padding: 15px; margin: 10px; border-radius: 8px; border: none; background: #007bff; color: white; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Kuvista videoksi</h1>
    <input type="file" id="imageUpload" accept="image/*" multiple>
    <br>
    <button onclick="createVideo()">Luo video</button>
    <video id="outputVideo" controls></video>

    <script>
        const { FFmpeg } = ffmpeg;
        let ff = null;

        async function createVideo() {
            const status = document.querySelector('h1');
            const files = document.getElementById('imageUpload').files;
            if (files.length === 0) return alert("Valitse kuvia!");

            if (ff === null) {
                ff = new FFmpeg();
                status.innerText = "Ladataan moottoria...";
                // Tämä 'core.js' lataus on se kriittinen kohta
                await ff.load({
                    coreURL: "https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd/ffmpeg-core.js",
                });
            }

            status.innerText = "Käsitellään...";

            // Kirjoitetaan kuvat muistiin
            for (let i = 0; i < files.length; i++) {
                const data = await ffmpeg.fetchFile(files[i]);
                await ff.writeFile(`img${i}.jpg`, data);
            }

            status.innerText = "Luodaan videota...";
            
            // FFmpeg-komento (yksinkertaistettu kännykälle)
            await ff.exec([
                '-framerate', '1',
                '-i', 'img%d.jpg',
                '-c:v', 'libx264',
                '-pix_fmt', 'yuv420p',
                'output.mp4'
            ]);

            const data = await ff.readFile('output.mp4');
            const video = document.getElementById('outputVideo');
            video.src = URL.createObjectURL(new Blob([data.buffer], { type: 'video/mp4' }));
            
            status.innerText = "Valmis!";
        }
    </script>
</body>
</html>
